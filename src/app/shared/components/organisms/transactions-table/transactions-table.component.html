<div class="transactions-table">
  <!-- Loading State -->
  <div *ngIf="!transactions" class="transactions-table-loading">
    <p class="transactions-table-loading-text">Cargando transacciones...</p>
  </div>
  <div>
    <app-gradient-header
    [title]="title || 'Transacciones'"
    [showInfo]="false">
</app-gradient-header>
  </div>

  <!-- Search Bar -->
  <div class="transactions-table-search">
    <app-search-bar
      [placeholder]="searchPlaceholder"
      [value]="searchValue"
      (search)="onSearchChange($event)">
    </app-search-bar>
  </div>

  <!-- Vista Desktop: Tabla -->
  <div *ngIf="transactions && isDesktop" class="transactions-table-desktop">
    <div class="w-full overflow-x-auto">
      <table class="w-full border-collapse">
        <!-- Header -->
        <thead>
          <tr class="transactions-table-header">
            <th class="transactions-table-header-cell">Transacción</th>
            <th class="transactions-table-header-cell">Fecha y Hora</th>
            <th class="transactions-table-header-cell">Método de Pago</th>
            <th class="transactions-table-header-cell">ID Transacción</th>
            <th class="transactions-table-header-cell">Monto</th>
          </tr>
        </thead>

        <!-- Body -->
        <tbody>
          <tr *ngIf="transactions.length === 0" class="transactions-table-empty-row">
            <td colspan="5" class="transactions-table-empty-cell">
              No se encontraron transacciones
            </td>
          </tr>
          
          <tr 
            *ngFor="let transaction of (paginatedTransactions$ | async); trackBy: trackByFn; let i = index"
            class="transactions-table-row"
            [class.transactions-table-row--bordered]="showRowBorderFn(transaction, i)"
            (click)="onTransactionClick(transaction)">
            
            <!-- Status Cell -->
            <td class="transactions-table-cell">
              <app-transaction-status-cell
                [type]="getTransactionStatusData(transaction).type"
                [status]="getTransactionStatusData(transaction).status">
              </app-transaction-status-cell>
            </td>
            
            <!-- DateTime Cell -->
            <td class="transactions-table-cell">
              <app-datetime-cell
                [date]="transaction.createdAt"
                [format]="'full'">
              </app-datetime-cell>
            </td>
            
            <!-- Payment Method Cell -->
            <td class="transactions-table-cell">
              <app-payment-method-cell
                [paymentMethod]="getPaymentMethodData(transaction).paymentMethod"
                [franchise]="getPaymentMethodData(transaction).franchise">
              </app-payment-method-cell>
            </td>
            
            <!-- Transaction ID Cell -->
            <td class="transactions-table-cell">
              <app-transaction-id-cell
                [id]="transaction.transactionReference"
                [copiable]="true">
              </app-transaction-id-cell>
            </td>
            
            <!-- Amount Cell -->
            <td class="transactions-table-cell">
              <app-amount-cell
                [amount]="getAmountData(transaction).amount"
                [deduction]="getAmountData(transaction).deduction"
                [align]="'left'">
              </app-amount-cell>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Vista Mobile: Lista -->
  <div *ngIf="transactions && !isDesktop" class="transactions-table-mobile">
    <div *ngIf="transactions.length === 0" class="transactions-table-empty">
      <p>No se encontraron transacciones</p>
    </div>
    <div *ngFor="let transaction of (paginatedTransactions$ | async); trackBy: trackByFn" class="transactions-table-card">
      <app-transaction-card
        [transaction]="transaction"
        [showDeduction]="showDeductions"
        [clickable]="true"
        (cardClick)="onTransactionClick($event)">
      </app-transaction-card>
    </div>
  </div>

  <!-- Paginación -->
  <div *ngIf="showPagination && transactions && transactions.length > 0" class="transactions-table-pagination">
    <app-pagination
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      [pageSize]="pageSize"
      [totalItems]="totalItems"
      [canPreviousPage]="canPreviousPage"
      [canNextPage]="canNextPage"
      [pageSizeOptions]="paginationConfig.pageSizeOptions || [10, 20, 50, 100]"
      (onPageChange)="onPageChange($event)"
      (onPageSizeChange)="onPageSizeChange($event)">
    </app-pagination>
  </div>
</div>
